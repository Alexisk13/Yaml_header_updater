for file in $files; do 
  echo "  checking file $file"

  if grep -q "\$LastChangedRevision:" "$file"; then
    # Check if the file has the upper separator
    if grep -qE '^-{5,}' "$file"; then 
      VERSION=$(grep -o '\$LastChangedRevision: [0-9]*' "$file" | awk '{print $2}')
      NEW_VERSION=$((VERSION + 1))

      read -r -d '' HEADER <<EOF
-----------------------------------------------------------------------------
-- Version
--   \$LastChangedRevision: $NEW_VERSION \$;
--
-- Date
--   \$LastChangedDate: $(date +"%Y-%m-%d %H:%M:%S %z (%a, %d %b %Y)") \$;
--
-- Author
--   \$LastChangedBy: $author \$;
-----------------------------------------------------------------------------
EOF

      # Delete only if upper separator exists
      sed -i '/^-\{5,\}/,/^-\{5,\}/d' "$file"

      # Insert the new header
      echo -e "$HEADER\n$(cat "$file")" > temp.sql && mv temp.sql "$file"
    else
      echo "  Skipping $file (missing upper separator)"
    fi
  fi
done
